<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text to Speech Indonesia - ElevenLabs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .voice-option {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .voice-option:hover {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }
        
        .voice-option.selected {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-color: #3b82f6;
        }
        
        .dropdown-open {
            transform: rotate(180deg);
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .wave-animation {
            animation: wave 1.5s ease-in-out infinite;
        }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(1.5); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">üéôÔ∏è Text to Speech Indonesia</h1>
            <p class="text-gray-600">Powered by ElevenLabs AI Voice Technology</p>
        </div>

        <!-- Main Card -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-6">
            <!-- Text Input -->
            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-3">Masukkan Teks</label>
                <textarea 
                    id="textInput" 
                    placeholder="Ketik teks yang ingin diubah menjadi suara..."
                    class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none resize-none transition-colors"
                    rows="4"
                >Halo, ini adalah contoh text to speech menggunakan suara Indonesia dari ElevenLabs.</textarea>
                <div class="text-right mt-2">
                    <span id="charCount" class="text-sm text-gray-500">0 karakter</span>
                </div>
            </div>

            <!-- Voice Selection -->
            <div class="mb-6">
                <label class="block text-sm font-semibold text-gray-700 mb-4">Pilih Karakter Suara</label>
                <div class="relative">
                    <button 
                        id="voiceDropdownBtn" 
                        class="w-full bg-white border-2 border-gray-200 rounded-xl p-4 text-left flex items-center justify-between hover:border-blue-300 focus:border-blue-500 focus:outline-none transition-colors"
                    >
                        <div class="flex items-center gap-3">
                            <span id="selectedVoiceEmoji" class="text-2xl">üë®</span>
                            <div>
                                <div id="selectedVoiceName" class="font-semibold text-gray-800">Andra</div>
                                <div id="selectedVoiceDesc" class="text-sm text-gray-500">Suara pria dewasa</div>
                            </div>
                        </div>
                        <svg id="dropdownArrow" class="w-5 h-5 text-gray-400 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    
                    <div id="voiceDropdown" class="absolute top-full left-0 right-0 mt-2 bg-white border-2 border-gray-200 rounded-xl shadow-lg z-10 max-h-80 overflow-y-auto hidden">
                        <div id="voiceOptions" class="p-2">
                            <!-- Voice options will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex flex-col sm:flex-row gap-4 items-center justify-between">
                <div class="flex items-center gap-4">
                    <button 
                        id="generateBtn" 
                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-semibold transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        <span id="generateIcon">üéµ</span>
                        <span id="generateText">Generate Suara</span>
                    </button>
                    
                    <button 
                        id="playBtn" 
                        class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                        disabled
                    >
                        <span>‚ñ∂Ô∏è</span>
                        <span>Play</span>
                    </button>
                </div>

                <div class="flex items-center gap-4">
                    <button 
                        id="downloadBtn" 
                        class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-xl font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                        disabled
                    >
                        <span>üíæ</span>
                        <span>Download</span>
                    </button>
                </div>
            </div>

            <!-- Status -->
            <div id="statusMessage" class="mt-4 p-3 rounded-lg hidden"></div>
        </div>

        <!-- Audio Player (Hidden) -->
        <audio id="audioPlayer" class="hidden" controls></audio>

        <!-- Footer -->
        <div class="text-center text-gray-500 text-sm">
            <p>Menggunakan ElevenLabs API ‚Ä¢ Dibuat dengan ‚ù§Ô∏è untuk Indonesia</p>
        </div>
    </div>

    <script>
        // Voice characters data - Voice ID Indonesia yang sebenarnya dari ElevenLabs
        const voices = [
            { name: 'Andra', id: 'gP7FRCgEZ8Lr3rnyGgpw', emoji: 'üë®', description: 'Suara pria dewasa' },
            { name: 'Kira', id: 'gmnazjXOFoOcWA59sd5m', emoji: 'üë©', description: 'Suara wanita muda' },
            { name: 'Sikedewi', id: 'yLyL4E4r0QfLyYpCwPir', emoji: 'üë∏', description: 'Suara wanita elegan' },
            { name: 'Dakocan', id: 'plgKUYgnlZ1DCNh54DwJ', emoji: 'üßî', description: 'Suara pria mature' },
            { name: 'Olish', id: 'ns6yZ71lNARqZPl46Ccn', emoji: 'üë¶', description: 'Suara pria muda' },
            { name: 'Bram', id: 'X8n8hOy3e8VLQnHTUcc5', emoji: 'üë®‚Äçüíº', description: 'Suara pria profesional' },
            { name: 'Dhea', id: 'LcvlyuBGMjj1h4uAtQjo', emoji: 'üë©‚Äçüé§', description: 'Suara wanita ceria' },
            { name: 'Uncle Mizan', id: 'ACRfKVNOAnzVitkYerdl', emoji: 'üë¥', description: 'Suara pria senior' },
            { name: 'Gavrila', id: 'gjhfBUoH6DHh0DG1X4u0', emoji: 'üë©‚Äçüíª', description: 'Suara wanita modern' },
            { name: 'Bee Ard', id: '1k39YpzqXZn52BgyLyGO', emoji: 'üé≠', description: 'Suara karakter unik' },
            { name: 'Livna', id: 'GdyFAZdMpKMBHw5pc1Bu', emoji: 'üë©‚Äçüé®', description: 'Suara wanita artistik' },
            { name: 'Nilasari', id: 'NPDHDOOQCSyifTJZOe6J', emoji: 'üë©‚Äçüè´', description: 'Suara wanita bijaksana' },
            { name: 'Mila Rahmadhania', id: 'wWRuqXP4yAwzRerUveS8', emoji: 'üë©‚Äçüéì', description: 'Suara wanita terpelajar' }
        ];

        // Ganti dengan URL Cloudflare Worker Anda
        const WORKER_URL = 'https://tts-indonesia-api.annasmashuri97.workers.dev/';

        let selectedVoice = voices[0];
        let currentAudio = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderVoiceOptions();
            setupEventListeners();
            updateCharCount();
        });

        function renderVoiceOptions() {
            const voiceOptions = document.getElementById('voiceOptions');
            voiceOptions.innerHTML = voices.map((voice, index) => `
                <div class="voice-option border-2 border-gray-200 rounded-lg p-3 mb-2 flex items-center gap-3 ${index === 0 ? 'selected' : ''}" 
                     data-voice-id="${voice.id}" data-voice-name="${voice.name}" data-voice-emoji="${voice.emoji}" data-voice-desc="${voice.description}">
                    <span class="text-2xl">${voice.emoji}</span>
                    <div class="flex-1">
                        <div class="font-semibold text-gray-800">${voice.name}</div>
                        <div class="text-sm text-gray-500">${voice.description}</div>
                    </div>
                    <div class="w-4 h-4 rounded-full border-2 border-gray-300 ${index === 0 ? 'bg-blue-500 border-blue-500' : ''}"></div>
                </div>
            `).join('');

            // Add click handlers
            document.querySelectorAll('.voice-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectVoice(this);
                });
            });
        }

        function selectVoice(selectedOption) {
            // Update selected state
            document.querySelectorAll('.voice-option').forEach(opt => {
                opt.classList.remove('selected');
                opt.querySelector('.w-4').classList.remove('bg-blue-500', 'border-blue-500');
                opt.querySelector('.w-4').classList.add('border-gray-300');
            });
            
            selectedOption.classList.add('selected');
            selectedOption.querySelector('.w-4').classList.add('bg-blue-500', 'border-blue-500');
            selectedOption.querySelector('.w-4').classList.remove('border-gray-300');
            
            // Update dropdown button display
            const voiceId = selectedOption.dataset.voiceId;
            const voiceName = selectedOption.dataset.voiceName;
            const voiceEmoji = selectedOption.dataset.voiceEmoji;
            const voiceDesc = selectedOption.dataset.voiceDesc;
            
            document.getElementById('selectedVoiceEmoji').textContent = voiceEmoji;
            document.getElementById('selectedVoiceName').textContent = voiceName;
            document.getElementById('selectedVoiceDesc').textContent = voiceDesc;
            
            selectedVoice = voices.find(v => v.id === voiceId);
            
            // Close dropdown
            closeDropdown();
            
            showStatus(`Suara ${voiceName} dipilih`, 'success');
        }

        function toggleDropdown() {
            const dropdown = document.getElementById('voiceDropdown');
            const arrow = document.getElementById('dropdownArrow');
            
            if (dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
                arrow.classList.add('dropdown-open');
            } else {
                closeDropdown();
            }
        }

        function closeDropdown() {
            const dropdown = document.getElementById('voiceDropdown');
            const arrow = document.getElementById('dropdownArrow');
            
            dropdown.classList.add('hidden');
            arrow.classList.remove('dropdown-open');
        }

        function setupEventListeners() {
            const textInput = document.getElementById('textInput');
            const generateBtn = document.getElementById('generateBtn');
            const playBtn = document.getElementById('playBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const voiceDropdownBtn = document.getElementById('voiceDropdownBtn');

            textInput.addEventListener('input', updateCharCount);
            generateBtn.addEventListener('click', generateSpeech);
            playBtn.addEventListener('click', playAudio);
            downloadBtn.addEventListener('click', downloadAudio);
            voiceDropdownBtn.addEventListener('click', toggleDropdown);

            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                const dropdown = document.getElementById('voiceDropdown');
                const dropdownBtn = document.getElementById('voiceDropdownBtn');
                
                if (!dropdown.contains(event.target) && !dropdownBtn.contains(event.target)) {
                    closeDropdown();
                }
            });
        }

        function updateCharCount() {
            const textInput = document.getElementById('textInput');
            const charCount = document.getElementById('charCount');
            charCount.textContent = `${textInput.value.length} karakter`;
        }

        async function generateSpeech() {
            const textInput = document.getElementById('textInput');
            const text = textInput.value.trim();

            if (!text) {
                showStatus('Mohon masukkan teks terlebih dahulu', 'error');
                return;
            }

            if (text.length > 2500) {
                showStatus('Teks terlalu panjang. Maksimal 2500 karakter.', 'error');
                return;
            }

            setGeneratingState(true);
            showStatus('Sedang menggenerate suara...', 'loading');

            try {
                const response = await fetch(WORKER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        voice_id: selectedVoice.id
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP ${response.status}`);
                }

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                
                currentAudio = {
                    url: audioUrl,
                    blob: audioBlob,
                    filename: `tts_${selectedVoice.name}_${Date.now()}.mp3`
                };

                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.src = audioUrl;

                document.getElementById('playBtn').disabled = false;
                document.getElementById('downloadBtn').disabled = false;

                showStatus(`Suara berhasil digenerate dengan ${selectedVoice.name}!`, 'success');

            } catch (error) {
                console.error('Error:', error);
                showStatus(`Error: ${error.message}`, 'error');
            } finally {
                setGeneratingState(false);
            }
        }

        function playAudio() {
            if (currentAudio) {
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.play();
                showStatus('Memutar audio...', 'success');
            }
        }

        function downloadAudio() {
            if (currentAudio) {
                const a = document.createElement('a');
                a.href = currentAudio.url;
                a.download = currentAudio.filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                showStatus('Audio berhasil didownload!', 'success');
            }
        }

        function setGeneratingState(isGenerating) {
            const generateBtn = document.getElementById('generateBtn');
            const generateIcon = document.getElementById('generateIcon');
            const generateText = document.getElementById('generateText');

            generateBtn.disabled = isGenerating;
            
            if (isGenerating) {
                generateIcon.innerHTML = '<div class="loading-spinner w-4 h-4 border-2 border-white border-t-transparent rounded-full"></div>';
                generateText.textContent = 'Generating...';
            } else {
                generateIcon.textContent = 'üéµ';
                generateText.textContent = 'Generate Suara';
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = `mt-4 p-3 rounded-lg ${getStatusClass(type)}`;
            statusDiv.textContent = message;
            statusDiv.classList.remove('hidden');

            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.classList.add('hidden');
                }, 3000);
            }
        }

        function getStatusClass(type) {
            switch (type) {
                case 'success': return 'bg-green-100 text-green-800 border border-green-200';
                case 'error': return 'bg-red-100 text-red-800 border border-red-200';
                case 'loading': return 'bg-blue-100 text-blue-800 border border-blue-200';
                default: return 'bg-gray-100 text-gray-800 border border-gray-200';
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'980de09b51099c50',t:'MTc1ODE2NzQwOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
